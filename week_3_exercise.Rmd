---
title: "week_3_exercise"
author: "Tim FÃ¤ssler"
date: "5/6/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Preparation

```{r}
library(readr)
library(sf)
library(dplyr)
library(ggplot2)

```

# Task 1: Segmentation
```{r}
data <- read_delim("caro60.csv", ",")
caro <- data.frame(data)
  

caro <- caro %>%
  mutate(
    nMinus3 = sqrt((lag(E,3)-E)^2+(lag(N,3)-N)^2),
    nMinus2 = sqrt((lag(E,2)-E)^2+(lag(N,2)-N)^2),
    nMinus1 = sqrt((lag(E,1)-E)^2+(lag(N,1)-N)^2),
    nPlus1  = sqrt((E-lead(E,1))^2+(N-lead(N,1))^2), 
    nPlus2  = sqrt((E-lead(E,2))^2+(N-lead(N,2))^2),
    nPlus3  = sqrt((E-lead(E,3))^2+(N-lead(N,3))^2)
  )

caro <- caro %>%
  rowwise() %>%
  mutate(
    stepMean = mean(c(nMinus3, nMinus2, nMinus1,nPlus1,nPlus2, nPlus3))
  ) %>%
  ungroup()

summary(caro$stepMean)
```

# Task 2: Specify and apply threshold d

```{r}
hist(caro$stepMean)

caro <- caro %>% 
  ungroup() %>%
  mutate(static = stepMean < 10)
```

# Task 3: Visualize segmented trajectories

```{r}

caro_filter <- caro %>%
  filter(!static)

caro_filter%>%
  ggplot(aes(E, N))  +
  geom_path() +
  geom_point() +
  coord_fixed() +
  theme(legend.position = "bottom") +
  ggtitle("Only points while moving")


ggplot() +
  geom_path(caro_filter, mapping = aes(E, N)) +
  geom_point(caro, mapping = aes(E, N, color = static)) +
  ggtitle("Static vs moving points")
```

